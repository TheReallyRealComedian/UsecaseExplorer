{% extends "base.html" %}

{% block title %}{{ title }} - Usecase Explorer{% endblock %}

{% block content %}
<div class="step-overview-page">
    <h1>{{ title }}</h1>
    <p class="text-color-light mb-4">
        A comprehensive list of all defined Process Steps, grouped by their parent Area, and including associated Use Cases.
    </p>

    <div class="data-section">
        {% if steps %}
            {# Group steps by area for better visual organization #}
            {% set current_area_name = "" %}
            {% for step in steps %}
                {% if step.area.name != current_area_name %}
                    {% if not loop.first %}
                        </ul> {# Close previous area's step list #}
                        </div> {# Close previous area-card #}
                    {% endif %}
                    {% set current_area_name = step.area.name %}
                    <div class="area-card mb-xl"> {# Reuse area-card styling #}
                        <h3>
                            Area: <a href="{{ url_for('areas.view_area', area_id=step.area.id) }}">{{ step.area.name }}</a>
                        </h3>
                        <ul class="list-unstyled item-list">
                {% endif %}
                        <li class="mb-2">
                            <div class="item-title">
                                <a href="{{ url_for('steps.view_step', step_id=step.id) }}">{{ step.name }}</a>
                            </div>
                            <div class="item-meta">
                                <small class="text-muted">(BI_ID: {{ step.bi_id }})</small>
                                {% if step.step_description %}<p class="small text-muted mb-0">{{ step.step_description | truncate(150, true) }}</p>{% endif %}
                            </div>
                            {% if step.use_cases %}
                                <ul class="usecase-list mt-1">
                                    {% for uc in step.use_cases | sort(attribute='name') %}
                                    <li>
                                        <a href="{{ url_for('usecases.view_usecase', usecase_id=uc.id) }}">{{ uc.name }}</a>
                                        <small class="uc-details text-muted">(UC BI_ID: {{ uc.bi_id }})</small>
                                    </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="mb-0 ms-3"><em><small>No use cases directly under this step.</small></em></p>
                            {% endif %}
                        </li>
                {% if loop.last %}
                    </ul> {# Close the last area's step list #}
                    </div> {# Close the last area-card #}
                {% endif %}
            {% endfor %}
        {% else %}
            <div class="card">
                <div class="card-body">
                    <p class="text-muted text-center"><em>No process steps found in the database. You can add steps using the <a href="{{ url_for('injection.data_update_page') }}">Data Update</a> page.</em></p>
                </div>
            </div>
        {% endif %}
    </div>

    <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Back to Home</a>
</div>
{% endblock %} 